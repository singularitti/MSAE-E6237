% !TEX root = ./report.tex

\subsection{Main program}

First we call \texttt{CRSTL} subroutine, see \ref{sssec:crstl} for more detail.
Second we call \texttt{INIT} subroutine, see \ref{sssec:init} for more detail.



Then we start a MD loop.
First update the current step \texttt{nzero}, and then update those
accumulators \texttt{acu}, \texttt{ack} and \texttt{acp}, then calculate
their averages by dividing \texttt{nzero}. Then call \texttt{MOVE} subroutine,
\texttt{p} is updated during this step, however \texttt{vcell} is not.
Then calculate $P \Omega$ and do a corresponding accumulator \texttt{acpv} and
average \texttt{avpv}. And then, update arrays like \texttt{utm} with length
\texttt{nstep} (read from input).
Then calculate the new temperature, \texttt{tnew}, by assuming equipartition
theorem $\mean{E} = \frac{ 3 }{ 2 } k_B T$, where $\mean{E}$ is
the average kinetic energy \texttt{avk}.
Then do rescaling on Cartesian velocity \texttt{v} and reduced velocity
\texttt{ratd}.

% Table generated by Excel2LaTeX from sheet 'Sheet1'
\begin{table}[h]
	\centering
	\caption{List of some output variables of main program.}
	\begin{tabular}{@{}rlccc@{}}
		\toprule
		\multicolumn{2}{c}{variable name} & variable symbol & variable & write to file \\
		\midrule
		\multirow{4}[2]{*}{total}                                                         & potential energy     & $U_t$           & \texttt{utm}    & \multirow{4}[2]{*}{\texttt{e}}   \\
		                                                                                  & total kinetic energy & $E_t$           & \texttt{ekintm} &                                  \\
		                                                                                  & energy               & $\mathscr{E}_t$ & \texttt{etotm}  &                                  \\
		                                                                                  & $P \Omega$           & $P \Omega$      & \texttt{pvm}    &                                  \\
		\cmidrule{1-1}\cmidrule{4-5}    \multirow{3}[2]{*}{atomic contribution to total}  & potential energy     & $U_a$           & \texttt{utam}   & \multirow{6}[4]{*}{\texttt{eal}} \\
		                                                                                  & kinetic energy       & $E_a$           & \texttt{ekam}   &                                  \\
		                                                                                  & energy               & $\mathscr{E}_a$ & \texttt{etam}   &                                  \\
		\cmidrule{1-1}\cmidrule{4-4}    \multirow{3}[2]{*}{lattice contribution to total} & potential energy     & $U_l$           & \texttt{utlm}   &                                  \\
		                                                                                  & kinetic energy       & $E_l$           & \texttt{eklm}   &                                  \\
		                                                                                  & energy               & $\mathscr{E}_l$ & \texttt{etlm}   &                                  \\
		\cmidrule{1-1}\cmidrule{4-5}    \multirow{2}[2]{*}{average of accumulated}        & potential energy     & $\mean{U}_t$    & \texttt{avum}   & \multirow{2}[2]{*}{\texttt{ave}} \\
		                                                                                  & kinetic energy       & $\mean{E}_t$    & \texttt{avkm}   &                                  \\
		\bottomrule
	\end{tabular}
	\label{tab:lstvar}%
\end{table}%

At the end of MD loop, write outputs to files.
Some of the output variables are listed in Tab. \ref{tab:lstvar}.
The atomic and lattice contributions could be also understood as
ionic and cell contributions, respectively. Another
important output file is \texttt{avec}, which stores lengths and angles
between primitive cell vectors for each MD step, i.e.,
$\{a, b, c\}$ and $\{\alpha, \beta, \gamma\}$,
denoted by \texttt{bmodm} and
\texttt{thetam}, respectively.
\texttt{bmodm} at each MD step
is set to lattice vectors moduli \texttt{avmod}, computed by \texttt{MOVE} subroutine.
\texttt{tv} file stores the ``instantaneous'' temperature and volume
for each MD step.
